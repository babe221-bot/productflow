{% extends "layouts/base.html" %}

{% block content %}
<div class="container mx-auto p-4">
    <h2 class="text-2xl font-bold mb-4">Active Proposals</h2>
    <div id="proposal-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {% for proposal in proposals %}
            {% include "components/_proposal_card.html" with proposal=proposal %}
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const proposalSocket = new WebSocket(
        'ws://'
        + window.location.host
        + '/ws/proposals/'
    );

    proposalSocket.onmessage = function(e) {
        const data = JSON.parse(e.data);
        const proposalId = data.proposal_id;

        // Use HTMX to fetch the updated proposal card
        htmx.ajax('GET', `/governance/proposal_card/${proposalId}/`, {
            target: `#proposal-card-${proposalId}`,
            swap: 'outerHTML'
        });
    };

    proposalSocket.onclose = function(e) {
        console.error('Proposals socket closed unexpectedly');
    };
</script>
{% endblock %}
